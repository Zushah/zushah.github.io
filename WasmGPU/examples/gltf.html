<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>WasmGPU glTF Example</title>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { background: #111; overflow: hidden; }
            canvas { display: block; width: 100%; height: 100%; }
        </style>
    </head>
    <body>
        <canvas></canvas>
        <!-- Adapted from https://www.github.com/bhavjitAlt/threejs -->
        <script src="https://cdn.jsdelivr.net/gh/bhavjitAlt/threejs/trex_glb1.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/bhavjitAlt/threejs/trex_glb2.js"></script>
        <script type="module">
            import { WasmGPU } from "https://cdn.jsdelivr.net/gh/Zushah/WasmGPU@0.5.0/dist/WasmGPU.min.js";
            const canvas = document.querySelector("canvas");
            const wgpu = await WasmGPU.create(canvas);

            // Decode base64 glTF binary
            const trex_buffer = (Uint8Array.from(atob(trex_glb1 + trex_glb2), (c) => c.charCodeAt(0))).buffer;

            // Scene, camera, and light
            const scene = wgpu.createScene([0, 0, 0]);
            const camera = wgpu.createCamera.perspective({ fov: 45, near: 1, far: 1000 });
            camera.transform.setPosition(4, 6, 8);
            camera.lookAt(0, 0, 0);
            scene.addLight(wgpu.createLight.directional({
                direction: [-1, -2, -1],
                color: [1, 1, 1],
                intensity: 5
            }));

            // glTF model
            const gltf = await wgpu.loadGLTF(trex_buffer, { addToScene: false });
            for (const mesh of gltf.meshes) scene.add(mesh);

            // Render
            wgpu.run((dt, time) => {
                const radius = 12;
                const speed = 0.5;
                const camX = Math.sin(time * speed) * radius;
                const camZ = Math.cos(time * speed) * radius;
                camera.transform.setPosition(camX, 3, camZ);
                camera.lookAt(0, 3, 0);
                wgpu.render(scene, camera);
            });
        </script>
    </body>
</html>
